// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                 String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String              @db.VarChar(150)
  email              String              @unique @db.VarChar(255)
  password_hash      String
  mobile             String              @unique @db.VarChar(15)
  referer_code       String?             @db.VarChar(50)
  is_active          Boolean             @default(true)
  user_type          UserType            @default(NORMAL)
  created_at         DateTime            @default(now()) @db.Timestamp()
  updated_at         DateTime            @default(now()) @db.Timestamp()
  addresses          Address[]
  user_login_history UserLoginHistory[]
  orders             Order[]

  @@map("users")
}

model Address {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id          String   @db.Uuid
  complete_address String
  city             String   @db.VarChar(100)
  state            String   @db.VarChar(100)
  pincode          String   @db.VarChar(10)
  is_default       Boolean? @default(false)
  created_at       DateTime @default(now()) @db.Timestamp()
  updated_at       DateTime @default(now()) @db.Timestamp()
  user             User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("addresses")
}

model UserLoginHistory {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id      String   @db.Uuid
  ip_address   String?  @db.Inet
  device_info  String?
  user_agent   String?
  login_status String   @db.VarChar(20)
  login_at     DateTime @default(now()) @db.Timestamp()
  user         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("user_login_history")
}

model Order {
  id                     BigInt                   @id @default(autoincrement())
  user_id                String                   @db.Uuid
  order_type             OrderType
  shipment_status        ShipmentStatus           @default(PENDING)
  shipment_type          ShipmentType
  payment_mode           PaymentMode
  total_amount           Decimal                  @db.Decimal(12, 2)
  weight                 Decimal?                 @db.Decimal(10, 2) // Added weight field
  delivered_at           DateTime?                @db.Timestamp()    // Added delivered_at field
  created_at             DateTime                 @default(now()) @db.Timestamp()
  updated_at             DateTime                 @default(now()) @db.Timestamp()
  user                   User                     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  order_pickup_address   OrderPickupAddress?
  order_receiver_address OrderReceiverAddress?

  @@map("orders")
}

model OrderPickupAddress {
  id       String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id BigInt  @unique
  name     String  @db.VarChar(150)
  phone    String  @db.VarChar(15)
  email    String? @db.VarChar(255)
  address  String
  city     String  @db.VarChar(100)
  state    String  @db.VarChar(100)
  pincode  String  @db.VarChar(10)
  country  String  @default("India") @db.VarChar(100)
  order    Order   @relation(fields: [order_id], references: [id], onDelete: Cascade)

  @@map("order_pickup_addresses")
}

model OrderReceiverAddress {
  id       String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id BigInt  @unique
  name     String  @db.VarChar(150)
  phone    String  @db.VarChar(15)
  email    String? @db.VarChar(255)
  address  String
  city     String  @db.VarChar(100)
  state    String  @db.VarChar(100)
  pincode  String  @db.VarChar(10)
  country  String  @default("India") @db.VarChar(100)
  order    Order   @relation(fields: [order_id], references: [id], onDelete: Cascade)

  @@map("order_receiver_addresses")
}

enum UserType {
  ADMIN
  NORMAL
}

enum OrderType {
  SURFACE
  EXPRESS
}

enum ShipmentStatus {
  MANIFESTED
  IN_TRANSIT
  DISPATCHED
  DELIVERED
  NOT_PICKED
  PENDING
  CANCELLED
  RTO
}

enum ShipmentType {
  DOMESTIC
  INTERNATIONAL
}

enum PaymentMode {
  PREPAID
  COD
}
